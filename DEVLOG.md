# Development Log

История изменений для cherry-pick в main.

## #116 — тестовый тикет проверить работу нового воркфлоу
**Дата:** 2026-02-17
**Ветка:** dev/Gleb
**Коммит:** `9f01703`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `codex-review.sh`
- `playwright.config.ts`
- `tests/e2e/performance.spec.ts`
- `tests/e2e/smoke.spec.ts`

### Как перенести в main
```bash
git cherry-pick 9f017033cc9129056a4b90bfaacf7d4c5a3243e8
```

---


## #116 — тестовый тикет проверить работу нового воркфлоу
**Дата:** 2026-02-17
**Ветка:** dev/Gleb
**Коммит:** `04a176a`
**Статус:** ✅ готово к переносу

### Что сделано
Обновлены smoke и performance тесты с Tetris на Mahjong Solitaire. Все селекторы приведены в соответствие с текущим HTML (game-board как div, footer-btn-circle вместо control-btn, Mahjong-специфичные ID). Добавлена фильтрация ошибок Telegram SDK в console. Удалены тесты для несуществующих элементов (canvas, next-piece).

### Изменённые файлы
- `tests/e2e/smoke.spec.ts` — полное обновление под Mahjong: title, селекторы, кнопки, touch targets
- `tests/e2e/performance.spec.ts` — переименование Tetris→Mahjong, замена кнопок в memory leak тесте

### Как перенести в main
```bash
git cherry-pick 04a176a3940df3ed07e74c4895f0c4a4f870bae0
```

---

## #112 — Тест очереди 3
**Дата:** 2026-02-09  
**Ветка:** dev/Gleb  
**Коммит:** `4ce1a56`  
**Статус:** ✅ готово к переносу

### Изменённые файлы

### Как перенести в main
```bash
git cherry-pick 4ce1a56d33ae863ec919d07ce473d08488985b1e
```

---


## #112 — Тест очереди 3
**Дата:** 2026-02-09
**Ветка:** dev/Gleb
**Коммит:** `5433a86`
**Статус:** ✅ готово к переносу

### Что сделано
Тестовый тикет для проверки работы очереди. На скриншоте — кассовый инвойс от MS Electronics LTD (Лимассол, Кипр) на покупку EcoFlow SPP Solar Panel Portable 400W за €649.00 (€545.38 + 19% VAT €103.62), дата 05.01.2026, и чек Visa Debit contactless оплаты на ту же сумму. Исходники проекта не изменены.

### Изменённые файлы
- `DEVLOG.md` — добавлена запись о тикете

### Как перенести в main
```bash
git cherry-pick 5433a86b72d9bbce261508d162da43bb99d3efbb
```

---

## #111 — Тест очереди 2
**Дата:** 2026-02-09
**Ветка:** dev/Gleb
**Коммит:** `cf23c1b`
**Статус:** ✅ готово к переносу

### Изменённые файлы

### Как перенести в main
```bash
git cherry-pick cf23c1bd2bbdc772b67ccb4c3db1435f6a32ad49
```

---


## #111 — Тест очереди 2
**Дата:** 2026-02-09
**Ветка:** dev/Gleb
**Коммит:** `d31a6ac`
**Статус:** ✅ готово к переносу

### Что сделано
Тестовый тикет для проверки работы очереди. На скриншоте — интерфейс карточной пасьянс-игры (Solitaire) в винтажном стиле с тремя профилями игроков (Evelyn Lv15, Margaret, Helen), у каждого свой уровень, очки и прогресс коллекций. Внизу — рекламные баннеры. Исходники проекта не изменены.

### Изменённые файлы
- `DEVLOG.md` — добавлена запись о тикете

### Как перенести в main
```bash
git cherry-pick d31a6ac9c74bec78f7445bb335c11b3830defe42
```

---

## #110 — Тест очереди 1
**Дата:** 2026-02-09  
**Ветка:** dev/Gleb  
**Коммит:** `1e644da`  
**Статус:** ✅ готово к переносу

### Изменённые файлы

### Как перенести в main
```bash
git cherry-pick 1e644da93d9beabb11ac5142384c4c770404a408
```

---


## #110 — Тест очереди 1
**Дата:** 2026-02-09
**Ветка:** dev/Gleb
**Коммит:** `038c4f9`
**Статус:** ✅ готово к переносу

### Что сделано
Тестовый тикет для проверки работы очереди. На скриншоте — учебная таблица греческих вопросительных и неопределённых местоимений (Πού, Τι, Ποιος, Πότε и соответствующие пары). Исходники проекта не изменены.

### Изменённые файлы
- `DEVLOG.md` — добавлена запись о тикете

### Как перенести в main
```bash
git cherry-pick 038c4f937e5ac93c3d2c8f8b095c33b1f6ddf36a
```

---

## #109 — пустой тикет 3, проверить работу очереди тикетов
**Дата:** 2026-02-09  
**Ветка:** dev/Gleb  
**Коммит:** `d757610`  
**Статус:** ✅ готово к переносу

### Изменённые файлы

### Как перенести в main
```bash
git cherry-pick d757610d55cab818ec875a27b800c70f327da565
```

---


## #109 — пустой тикет 3, проверить работу очереди тикетов
**Дата:** 2026-02-09
**Ветка:** dev/Gleb
**Коммит:** `e340513`
**Статус:** ✅ готово к переносу

### Что сделано
Пустой тикет для проверки работы очереди тикетов. Никаких изменений в коде — только запись в DEVLOG.

### Изменённые файлы

### Как перенести в main
```bash
git cherry-pick e3405136006b8783d0f47da9020c2d10ec45231f
```

---

## #107 — пустой тикет 1, проверить работу очереди тикетов
**Дата:** 2026-02-09  
**Ветка:** dev/Gleb  
**Коммит:** `0ecfb38`  
**Статус:** ✅ готово к переносу

### Изменённые файлы

### Как перенести в main
```bash
git cherry-pick 0ecfb383af9808c8ea843ec830fb1d955080fe60
```

---


## #107 — пустой тикет 1, проверить работу очереди тикетов
**Дата:** 2026-02-09
**Ветка:** dev/Gleb
**Коммит:** `9290f21`
**Статус:** ✅ готово к переносу

### Что сделано
Пустой тикет для проверки работы очереди тикетов. Никаких изменений в коде — только запись в DEVLOG.

### Изменённые файлы
- `DEVLOG.md` — добавлена запись о тикете

### Как перенести в main
```bash
git cherry-pick 9290f214c4b7213566b4eba2ffca87f34cdbce5e
```

---

## #106 — летящая пара костей должна всегда по глубине быть выше всех остальных и все еще
**Дата:** 2026-02-06  
**Ветка:** dev/Gleb  
**Коммит:** `e9a690f`  
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick e9a690f213ac2d4877f3f8e868bf3a17870094da
```

---


## #106 — летящая пара костей должна всегда по глубине быть выше всех остальных
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `a6b9ab9`
**Статус:** ✅ готово к переносу

### Что сделано
Летящие кости при слёте теперь всегда отображаются поверх всех остальных элементов (z-index: 10000). Исправлена точка встречи — обе кости теперь летят в одну и ту же точку и накладываются друг на друга перед исчезновением, создавая эффект столкновения, вместо того чтобы приземляться рядом с зазором.

### Изменённые файлы
- `app.js` — z-index 10000 для летящих костей в removePair и animateArc, точка встречи изменена на совпадающую для обеих костей

### Как перенести в main
```bash
git cherry-pick a6b9ab9fe937be55b1931b5455ac28dd3a6e0317
```

---

## #105 — картинки с прямоугольными рамками еще есть куда увеличивать и они чуть ниже отно
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `245e75e`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 245e75ee9d9107518ec63933378d79d6f023e4a0
```

---


## #105 — картинки с прямоугольными рамками еще есть куда увеличивать и они чуть ниже отно
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `82aac06`
**Статус:** ✅ готово к переносу

### Что сделано
Увеличен размер emoji-картинок на костях (цветы и сезоны) с коэффициента 0.78 до 0.92 от базового размера шрифта. Исправлено вертикальное смещение — картинки были ниже центра кости (translateY -2%), теперь выровнены по центру (translateY -8%), как и остальные символы.

### Изменённые файлы
- `style.css` — увеличен font-size для `.tile-face-image` (0.78→0.92), исправлен translateY (-2%→-8%)

### Как перенести в main
```bash
git cherry-pick 82aac06eeb842a72d739abf7f625877a265e53af
```

---

## #104 — еще лучше доработай слет, высчитывай координаты точки слета костей таким образом
**Дата:** 2026-02-06  
**Ветка:** dev/Gleb  
**Коммит:** `e1196b9`  
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick e1196b9d32f174c6cdbce7ecad8e3c22b888d533
```

---


## #104 — еще лучше доработай слет, высчитывай координаты точки слета костей таким образом
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `3bcce19`
**Статус:** ✅ готово к переносу

### Что сделано
Доработана анимация слёта парных костей: теперь финальная точка встречи рассчитывается так, чтобы обе кости оказывались на одной горизонтальной линии (одинаковая Y-координата), как будто стоят на одной поверхности. Траектория полёта организована по дугам так, чтобы кости не пролетали друг над другом — если кости расположены вертикально (одна над другой), дуга увеличивается и кости разлетаются в стороны, а затем сходятся по широкой дуге.

### Изменённые файлы
- `app.js` — переписана функция `removePair()`: финальные позиции костей вычисляются на одной горизонтальной линии (meetY), кости встают бок о бок; при вертикальном расположении костей увеличена амплитуда дуги для обхода друг друга

### Как перенести в main
```bash
git cherry-pick 3bcce1922531d06c051f15744161afad1bd14e37
```

---

## #103 — баг дрожания заблокированной кости, после дрожания она срывается куда-то и приле
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `e69dbde`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick e69dbdea2b47954fbeab28ddaa38d83bc7d249d9
```

---


## #103 — баг дрожания заблокированной кости, после дрожания она срывается куда-то и прилетает обратно
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `1a1539d`
**Статус:** ✅ готово к переносу

### Что сделано
Исправлен баг, при котором заблокированная кость после shake-анимации "улетала" и возвращалась обратно. Причина: CSS `transition: transform 0.15s` на `.mahjong-tile` интерферировала с окончанием shake-анимации, вызывая плавную интерполяцию transform между состояниями. Добавлено `transition: none` на `.blocked.shake` и фильтрация `animationend` по имени анимации для предотвращения конфликтов с другими анимациями (fly-in).

### Изменённые файлы
- `style.css` — добавлено `transition: none` для `.mahjong-tile.blocked.shake`
- `app.js` — добавлена проверка `e.animationName !== 'tile-shake'` в обработчике animationend

### Как перенести в main
```bash
git cherry-pick 1a1539db4b488b9338f3954b6fb6a2131e00fb24
```

---

## #98 — сделай аккуратнее прилет, чтобы кости прилетали в финальную точку ударения на од
**Дата:** 2026-02-06  
**Ветка:** dev/Gleb  
**Коммит:** `6948fe8`  
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 6948fe85bc64717c681d4d84aec420212b5e766a
```

---


## #98 — аккуратнее прилёт костей, edge-to-edge столкновение, размер эмодзи
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `85b173f`
**Статус:** ✅ готово к переносу

### Что сделано
Переработана анимация столкновения костей: теперь они прилетают на одной высоте и останавливаются ровно при касании граней (edge-to-edge). Увеличены эмодзи маджонг-плиток для лучшего заполнения прямоугольника. Цветы и сезоны уменьшены и центрированы — больше не выступают за границы плитки. Анимация fly-in сделана плавнее без промежуточного отскока.

### Изменённые файлы
- `app.js` — новый расчёт точки столкновения (Minkowski half-extent), увеличен font-size эмодзи, добавлен класс tile-face-image для цветов/сезонов
- `style.css` — плавнее fly-in анимация, уменьшенный размер и центрирование для цветочных эмодзи

### Как перенести в main
```bash
git cherry-pick 85b173fb616f2da26ca6d674445e383d35cb677b
```

---

## #99 — давай выделим на прилет в два раза больше времени, слишком дерганно и быстро соб
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `f3ae80a`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick f3ae80ab1701f9faee0355c174b6fdcaa00fcf7c
```

---


## #99 — давай выделим на прилет в два раза больше времени, слишком дерганно и быстро соб
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `d0d20a1`
**Статус:** ✅ готово к переносу

### Что сделано
Удвоено время анимации прилёта (fly-in) костяшек. CSS-анимация увеличена с 0.7s до 1.4s, задержки появления (stagger delay) между костяшками также увеличены в 2 раза — layer*300 вместо 150, idx*6 вместо 3, random*200 вместо 100. Теперь кости прилетают плавнее и не дёргаются.

### Изменённые файлы
- `style.css` — длительность fly-in-anim увеличена с 0.7s до 1.4s
- `app.js` — удвоены stagger delay константы для fly-in анимации

### Как перенести в main
```bash
git cherry-pick d0d20a1b2cc97f0f6734cd715623521fa4a7d7cf
```

---

## #96 — оптимизируй под запуск в веб вью телеграмм, там зуминг чуть подрагивает, нет пла
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `6039a68`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `index.html`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 6039a68315d9bcb2b9e2d86ed7425ac6383d23d1
```

---


## #97 — почему-то в веб вью телеграм фон белый, а не зеленый как в вебе
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `f2cece6`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `index.html`
- `style.css`

### Как перенести в main
```bash
git cherry-pick f2cece63f9a7b78b65ca6b97264eef2c51158f7a
```

---


## #97 — почему-то в веб вью телеграм фон белый, а не зеленый как в вебе
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `697cf84`
**Статус:** ✅ готово к переносу

### Что сделано
Исправлен белый фон в Telegram WebView. Проблема: нативный контейнер WebView имеет белый фон по умолчанию, а зелёный градиент был задан только на body. Решение: 1) добавлен background: #072e27 на html,body для мгновенной отрисовки тёмного фона; 2) вызваны tg.setHeaderColor и tg.setBackgroundColor через Telegram WebApp API для установки нативного цвета WebView; 3) добавлен meta theme-color для WebView-контейнеров, которые читают его до загрузки CSS.

### Изменённые файлы
- `style.css` — добавлен background: #072e27 на html, body
- `app.js` — добавлены вызовы tg.setHeaderColor() и tg.setBackgroundColor()
- `index.html` — добавлен meta name="theme-color"

### Как перенести в main
```bash
git cherry-pick 697cf8474b560769658f0d07969fda7e56fd773c
```

---

## #96 — оптимизация под запуск в WebView Telegram
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `a7c6858`
**Статус:** ✅ готово к переносу

### Что сделано
Комплексная оптимизация производительности для Telegram WebView: GPU-ускорение всех анимаций через translate3d и will-change, замена left/top на transform в animateArc, батчинг DOM-вставок через DocumentFragment, дебаунс resize, блокировка pinch-zoom/double-tap/vertical-swipe жестов, viewport-fit=cover.

### Изменённые файлы
- `app.js` — GPU-ускоренные анимации, rAF-батчинг zoom, debounced resize, блокировка жестов WebView, disableVerticalSwipes
- `style.css` — will-change, backface-visibility, translate3d в keyframes, touch-action:none, contain:layout, font-smoothing
- `index.html` — viewport-fit=cover, minimum-scale=1.0

### Как перенести в main
```bash
git cherry-pick a7c6858b33742d3cedf350937f2df78f1f8a7720
```

---

## #95 — после перемешивания нужно снова гарантировать раскладываемость методом обратной
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `4f48ae7`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`

### Как перенести в main
```bash
git cherry-pick 4f48ae749e9fe0dbf0be3f2286795605fd0f75f2
```

---


## #95 — после перемешивания нужно снова гарантировать раскладываемость методом обратной
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `30eea4b`
**Статус:** ✅ готово к переносу

### Что сделано
Добавлена гарантия раскладываемости доски после перемешивания. Ранее при shuffle лица костяшек просто случайно перемешивались (Fisher-Yates), что не гарантировало решаемость. Теперь после перемешивания используется алгоритм обратной раскладки (reverse placement) — тот же метод, что и при генерации начальной доски: находим свободные позиции, назначаем на них пары, убираем из занятых, повторяем.

### Изменённые файлы
- `app.js` — добавлена функция `generateSolvableShuffleLayout()` для гарантии раскладываемости при перемешивании, обновлена `doReshuffle()` внутри `shuffleTiles()` для использования нового алгоритма

### Как перенести в main
```bash
git cherry-pick 30eea4b2136bd5e73b3d2dbd677338b111add08a
```

---

## #93 — при зумин, особенно когда остается несколько пар, залазят кости под маску, обрез
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `ca4fc32`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick ca4fc32c918f4c2f09ab5c5cfeeabacf6b347349
```

---

## #94 — еще на пару пикселей нужно поднять рисунки с рамками, все еще немножко ниже цент
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `40e91a1`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `style.css`

### Как перенести в main
```bash
git cherry-pick 40e91a137e0f5d9f85b316ef282e064dd11b2fdb
```

---

## #94 — еще на пару пикселей нужно поднять рисунки с рамками
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `71514f5`
**Статус:** ✅ готово к переносу

### Что сделано
Увеличен сдвиг вверх для содержимого тайлов (`.tile-face-content`) с `translateY(-8%)` до `translateY(-12%)`, чтобы рисунки с рамками были точнее по центру костяшки.

### Изменённые файлы
- `style.css` — увеличен translateY для `.tile-face-content` с -8% до -12%

### Как перенести в main
git cherry-pick 71514f5d3a5c56a48cab619b274c9531be7fdfd8

---

## #93 — при зумин, особенно когда остается несколько пар, залазят кости под маску, обрез
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `6fb94ec`
**Статус:** ✅ готово к переносу

### Что сделано
Исправлен баг с обрезанием костей при зуме. Причина: формула трансляции в calculateZoom() не учитывала множитель scale, из-за чего при масштабировании >1x кости смещались недостаточно и выходили за границы видимой области (overflow: hidden). Исправлена формула центрирования (tx = -(contentCenterX - boardCenterX) * scale) и добавлено ограничение (clamping) трансляции по краям контейнера. Уменьшен safety factor с 0.92 до 0.88.

### Изменённые файлы
- `app.js` — переписана функция calculateZoom(): исправлена формула трансляции с учётом scale, добавлен clamping по краям контейнера

### Как перенести в main
```bash
git cherry-pick 6fb94ec0f3dc70901acbfcc4a61828c95d198ad2
```

---

## #92 — кость на которой цветы, если она заблокирована, то сама кость полупрозрачная, а
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `e230206`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `style.css`

### Как перенести в main
```bash
git cherry-pick e23020663e81c6f1046fb6ede41e33c10486ec3f
```

---


## #92 — кость на которой цветы, если она заблокирована, то сама кость полупрозрачная
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `7c42673`
**Статус:** ✅ готово к переносу

### Что сделано
Добавлена полупрозрачность (opacity: 0.45) для содержимого (эмодзи) заблокированных костей. Ранее фон кости тускнел при блокировке, но эмодзи (цветы, сезоны и др.) оставались яркими, создавая ложное впечатление что кость доступна для игры.

### Изменённые файлы
- `style.css` — добавлено правило `.mahjong-tile.blocked .tile-face-content { opacity: 0.45 }`

### Как перенести в main
```bash
git cherry-pick 7c4267317853a534d38a5109da5b7edfab26f4a0
```

---

## #91 — просто тестовый тикет, убедиться что опус работает
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `310ef14`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`

### Как перенести в main
```bash
git cherry-pick 310ef14fb244d802249ea4fe171c1a18f3a14f16
```

---


## #91 — просто тестовый тикет, убедиться что опус работает
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `e8ade6e`
**Статус:** ✅ готово к переносу

### Что сделано
Тестовый тикет для проверки работоспособности Opus. Добавлен описательный комментарий в начало app.js.

### Изменённые файлы
- `app.js` — добавлен заголовочный комментарий

### Как перенести в main
```bash
git cherry-pick e8ade6e6f506f3b8717404b94528e9dce7e242ff
```

---

## #90 — не работает зумин по мере раскладывания
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `4f4e1d5`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`

### Как перенести в main
```bash
git cherry-pick 4f4e1d5843eca44921ab230e47d4f1ecb0bf806f
```

---


## #90 — не работает зумин по мере раскладывания
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `39f4a56`
**Статус:** ✅ готово к переносу

### Что сделано
Исправлен зум доски по мере удаления костяшек. Проблема была в том, что calculateZoomScale() пересчитывала размеры тайлов через calculateLayout(), которая учитывала только оставшиеся костяшки — это давало размеры, не совпадающие с реальными позициями тайлов на экране. Также ограничение maxScale не давало зуму увеличиваться выше ~1.0x. Теперь размеры тайлов сохраняются при рендере доски и используются для зума, добавлена трансляция для центрирования оставшегося контента.

### Изменённые файлы
- `app.js` — добавлена переменная lastRenderedLayout для хранения размеров тайлов при рендере; переписана функция calculateZoom() (бывш. calculateZoomScale) для использования сохранённых размеров и корректного масштабирования + центрирования контента

### Как перенести в main
```
git cherry-pick 39f4a56c9408331aa573a32a2e4d7cbaa5760eae
```

---

## #89 — теперь раскладка снова больше по ширине чем по высоте, подбери правильную пропор
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `97cbc12`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 97cbc122d88c6fa260082af76d441c20ee7a14d6
```

---


## #89 — теперь раскладка снова больше по ширине чем по высоте, подбери правильную пропор
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `316ce4b`
**Статус:** ✅ готово к переносу

### Что сделано
Переработана раскладка Turtle с ландшафтной (горизонтальной) обратно на портретную (вертикальную) ориентацию. Старая раскладка имела сетку 27×13 (ширина:высота ≈ 2:1), новая использует сетку 19×19 с 10 рядами на базовом слое, что при учёте пропорций тайлов (0.78 w:h) даёт визуально портретную доску (~78% ширины от высоты). Слои: 82 + 40 + 18 + 4 = 144 тайлов, все корректно покрыты и алгоритм решаемости работает.

### Изменённые файлы
- `app.js` — переписана getTurtleLayout() на портретную раскладку с 10 рядами, 4 слоями
- `DEVLOG.md` — исправлены merge-конфликтные маркеры, добавлена запись

### Как перенести в main
```bash
git cherry-pick 316ce4b04a8763d9e1ef7e65918af046d76ea565
```

---

## #88 — распологай костяшки таким образом, чтобы доска была решаемой
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `18a3fa5`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`

### Как перенести в main
```bash
git cherry-pick 18a3fa591c6d575faf2776cabe169a4c31f6fa1f
```

---

## #88 — распологай костяшки таким образом, чтобы доска была решаемой
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `456d595`
**Статус:** ✅ готово к переносу

### Что сделано
Реализован алгоритм обратной раскладки (reverse placement) для генерации гарантированно решаемой доски. Вместо случайного размещения костяшек, алгоритм начинает с полностью заполненной доски, находит свободные (удаляемые) позиции, назначает на них совпадающие пары и убирает из занятых. Это гарантирует, что для каждой пары существует путь к удалению.

### Изменённые файлы
- `app.js` — добавлены функции `isPositionFree()` и `generateSolvableLayout()`, обновлена `startGame()` для использования нового алгоритма

### Как перенести в main
```bash
git cherry-pick 456d59586cadce921355ba6900d98c7290ed3817
```

---

## #87 — все еще картинки в рамках чуть ниже центра костяшки, расположи еще аккуратнее от
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `0271620`
**Статус:** ✅ готово к переносу

### Что сделано
Улучшено центрирование эмодзи на костяшках домино. Вместо padding-bottom на tile-face, эмодзи теперь обёрнуты в span с CSS transform translateY(-8%), что точнее смещает глиф вверх и компенсирует визуальное смещение вниз, характерное для эмодзи-символов.

### Изменённые файлы
- `style.css` — убран padding-bottom: 8%, добавлен класс .tile-face-content с transform: translateY(-8%)
- `app.js` — эмодзи на костяшке обёрнут в `<span class="tile-face-content">` для точного позиционирования

### Как перенести в main
```bash
git cherry-pick 0271620ea6072f8efee0fd0dfd8a2278c751bcf4
```

---

## #84 — теперь расположение костяшки дает слишком высокую форму доски, много пространств
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `f4f33f9`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick f4f33f9f3082255a40a5ae5ba2c0f32ce7645fa5
```

---


## #84 — теперь расположение костяшки дает слишком высокую форму доски, много пространств
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `40bead5`
**Статус:** ✅ готово к переносу

### Что сделано
Переработана раскладка Turtle с портретной (вертикальной) на ландшафтную (горизонтальную) ориентацию. Доска теперь использует полную ширину экрана вместо того, чтобы быть высокой и узкой с пустым пространством по бокам. Исправлена проверка свободных тайлов на left/right вместо top/bottom. Уменьшен минимальный размер тайлов и оптимизированы отступы сетки для лучшего заполнения экрана.

### Изменённые файлы
- `app.js` — переписана getTurtleLayout() на ландшафтную раскладку, исправлена isTileFree() для горизонтальной ориентации, обновлён calculateLayout() с новым aspect ratio 0.78

### Как перенести в main
```bash
git cherry-pick 40bead5da472cb663c9788223d7bf04a0720f8ee
```

---

## #85 — когда нет ходов и случается перемешивание кости улетают и не возвращаются обратн
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `8071fb3`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`

### Как перенести в main
```bash
git cherry-pick 8071fb3bac1acfd5f3ef3480936750396be3d7ed
```

---


## #86 — не уменьшай и не уводи в полупрозрачность кости которые убираются и летят друг к
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `b5026dd`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`

### Как перенести в main
```bash
git cherry-pick b5026dd48a9568157b948dcc4bfdb86adb8e58cc
```

---


## #86 — не уменьшай и не уводи в полупрозрачность кости которые убираются и летят друг к
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `7b019ba`
**Статус:** ✅ готово к переносу

### Что сделано
Убрано уменьшение (scale) и затухание (opacity) костей при анимации удаления. Теперь кости летят друг к другу в оригинальном размере и полной непрозрачности, исчезая только в точке встречи.

### Изменённые файлы
- `app.js` — убраны строки scale и opacity из функции animateArc

### Как перенести в main
```bash
git cherry-pick 7b019baedccfa071d020fe9647b7e078e068fc41
```

---

## #85 — когда нет ходов и случается перемешивание кости улетают и не возвращаются обратно
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `0e94bc4`
**Статус:** ✅ готово к переносу

### Что сделано
Исправлена ошибка при перемешивании доски: кости улетали за экран и не возвращались обратно. Проблема была двойная: 1) координаты fly-out вычислялись некорректно — вместо чистых смещений от текущей позиции использовались абсолютные координаты с вычитанием позиции, что давало недостаточные смещения; 2) если событие animationend не срабатывало хотя бы для одной кости (что случается в мобильных WebView), reshuffle никогда не вызывался. Исправлены расчёты на чистые относительные смещения и добавлен safety fallback таймер.

### Изменённые файлы
- `app.js` — исправлен расчёт fly-out смещений в shuffleTiles() (чистые относительные offX/offY вместо абсолютных координат), добавлен флаг reshuffleDone для предотвращения двойного вызова, добавлен fallback setTimeout для гарантированного вызова doReshuffle()

### Как перенести в main
```bash
git cherry-pick 0e94bc42ea3a35a8e1f48e4f9aa4499736500f4b
```

---

## #83 — спозиционируй аккуратнее картинки которые с прямоугольниками относительно костяш
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `bbaab1b`
**Статус:** ✅ готово к переносу

### Что сделано
Добавлен padding-bottom: 8% к .tile-face, чтобы визуально поднять символы маджонга (Unicode-глифы с прямоугольными рамками) ближе к центру костяшки. Глифы с рамками имеют смещённый вниз визуальный центр, padding компенсирует это.

### Изменённые файлы
- `style.css` — добавлен padding-bottom: 8% к .tile-face для вертикального центрирования символов

### Как перенести в main
```bash
git cherry-pick bbaab1b6a03654c658c40ded4e3b986549e930f2
```

---

## #82 — теперь кости иногда не влазят по высоте и обрезаются
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `3582873`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 35828735f7a9f99dff57ba188a0dfa171deef2bd
```

---


## #82 — теперь кости иногда не влазят по высоте и обрезаются
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `2f423a6`
**Статус:** ✅ готово к переносу

### Что сделано
Исправлена проблема обрезки костяшек по высоте. В calculateLayout() добавлена проверка итоговых размеров доски (включая смещения слоёв и отступы) — если доска не помещается в доступное пространство, размер тайлов уменьшается пропорционально. Также исправлен расчёт размеров доски в renderBoard(): вместо захардкоженного множителя 4 используется реальное количество активных слоёв.

### Изменённые файлы
- `app.js` — добавлена верификация размера доски в calculateLayout(), исправлен расчёт boardW/boardH в renderBoard()

### Как перенести в main
```bash
git cherry-pick 2f423a6fc55bd6f8633579bdcdab9b264c795ab5
```

---

## #80 — зуминг должен происходить только когда появляется пространство под него, костяшк
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `d265b3d`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`
- `tickets/issue-82/screenshot.jpg`

### Как перенести в main
```bash
git cherry-pick d265b3d8a6508ee6fdecdaabf2c14b9516c6d40d
```

---

## #81 — когда нет ходов, перемешивай доску, пускай кости улетят и вернутся в новом поряд
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `e276091`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`
- `tickets/issue-82/screenshot.jpg`

### Как перенести в main
```bash
git cherry-pick e2760912b63c8ac6ba25e9a9bc01acb23d3afadb
```

---


## #81 — когда нет ходов, перемешивай доску, пускай кости улетят и вернутся в новом порядке
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `1fa8205`
**Статус:** ✅ готово к переносу

### Что сделано
Когда на доске не остаётся доступных ходов, вместо показа экрана "NO MOVES" автоматически запускается перемешивание. Кости разлетаются в стороны с анимацией fly-out, затем тасуются и возвращаются с анимацией fly-in в новом порядке. Ручная кнопка Shuffle тоже использует этот эффект.

### Изменённые файлы
- `app.js` — переписана функция shuffleTiles() с двухфазной анимацией (fly-out → reshuffle → fly-in), checkGameState() вызывает auto-shuffle вместо game over
- `style.css` — добавлена анимация fly-out-anim для разлёта костей

### Как перенести в main
```bash
git cherry-pick 1fa8205df9370fa53085bc033a79772607bad55e
```

---

## #80 — Зуминг должен происходить только когда появляется пространство, автоход по клику
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `6476539`
**Статус:** ✅ готово к переносу

### Что сделано
Зуминг теперь вычисляет bounding box оставшихся костяшек и зумит только если масштабированная доска помещается в контейнер — костяшки больше не обрезаются краем экрана. Кнопка Auto (автоход) теперь убирает одну пару за клик вместо непрерывного автоматического разбора.

### Изменённые файлы
- `app.js` — переписан calculateZoomScale() для учёта реального пространства, автоход переделан на single-shot (doAutoMove), удалён interval-based autoplay

### Как перенести в main
```bash
git cherry-pick 64765399c68cbcdeea8d54e5125ea86802e893cc
```

---

## #79 — все еще есть куда увеличивать рисунки на костяшках, есть пространство чтобы сдел
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `1776303`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 17763038bd4db116ccecc3e88c5aa430be33582c
```

---


## #79 — Увеличение рисунков на костяшках, портретная раскладка, анимация полёта по дуге
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `baab35c`
**Статус:** ✅ готово к переносу

### Что сделано
Увеличен размер символов на тайлах (0.92 от ширины вместо 0.75) для лучшей читаемости. Раскладка «Черепаха» транспонирована для портретной ориентации телефона — доска теперь выше, чем шире. Удалены декоративные линии справа и снизу от костяшек (tile-side-right, tile-side-bottom, tile-corner) для уменьшения визуального шума. Анимация совпадения пар заменена с прямолинейного полёта на полёт по дуге (bezier curve) — кости летят навстречу по изогнутой траектории и исчезают при соприкосновении.

### Изменённые файлы
- `app.js` — транспонированная раскладка, увеличенный размер шрифта, JS-анимация полёта по дуге (animateArc), удалено создание side/bottom/corner элементов, обновлена проверка свободных тайлов для портретной раскладки
- `style.css` — удалены стили 3D-сторон тайлов, удалена CSS fly-match анимация (заменена на JS), добавлена тень на тайлы

### Как перенести в main
```bash
git cherry-pick baab35ca1cdd3457e8c6873eb7d0efd23899eae2
```

---

## #78 — Сделай эффект сборки костей, когда парные кости летят друг на друга и исчезают к
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `216a40d`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `index.html`
- `notify.sh`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 216a40da319191fbab976cceb6c9fdd6cce7887d
```

---


## #78 — Эффект сборки костей, анимация доски, кнопка автохода
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `3b904d4`
**Статус:** ✅ готово к переносу

### Что сделано
Реализован эффект сборки парных костяшек: при совпадении кости летят друг к другу, соприкасаются и исчезают с партикл-эффектом. Добавлена анимация сборки доски — кости прилетают из-за пределов экрана при старте игры. Добавлена кнопка автохода (Auto) для автоматического разбора маджонга.

### Изменённые файлы
- `app.js` — fly-together анимация, создание частиц, board assembly animation, auto-play логика
- `style.css` — CSS-анимации fly-match, particle-burst, fly-in-anim, стили кнопки Auto
- `index.html` — добавлена кнопка Auto в footer

### Как перенести в main
```bash
git cherry-pick 3b904d440993d41096e1d72ed558b11afb372723
```

---

## #77 — Золотые костяшки пока не нужны
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `a75edc1`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `style.css`

### Как перенести в main
```bash
git cherry-pick a75edc1bf50f65fcecec3142c010e70d80cb1776
```

---


## #77 — Золотые костяшки пока не нужны
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `14ed7c0`
**Статус:** ✅ готово к переносу

### Что сделано
Убраны золотые костяшки (layer-top стиль). Увеличен размер символов на тайлах для максимальной читаемости. Уменьшена толщина 3D-сторон тайлов (с 4px до 2px) чтобы костяшка не выглядела как две, наложенные друг на друга. Адаптирована раскладка под вертикальный формат WebView — изменено соотношение сторон тайла (0.85 вместо 0.78), увеличен максимальный размер тайлов.

### Изменённые файлы
- `app.js` — убрано присвоение класса layer-top, увеличен размер шрифта символов (0.75 вместо 0.55), уменьшен layer offset, изменено соотношение сторон и максимальный размер тайлов
- `style.css` — удалены все стили .layer-top, уменьшена толщина 3D-сторон тайлов с 4px до 2px

### Как перенести в main
```bash
git cherry-pick 14ed7c0c8d9e9cd819bc281d032a290a2bf71553
```

---

## #76 — сделай дизайн максимально приближенно к этому референсу, убедись что костяшки вл
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `5be557a`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `index.html`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 5be557a20917bff88cf5f4cc64f9a56e15d98598
```

---


## #76 — сделай дизайн максимально приближенно к этому референсу
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `28582e0`
**Статус:** ✅ готово к переносу

### Что сделано
Полный редизайн маджонга по референсу: тёмно-зелёный градиентный фон, реалистичные 3D-костяшки с закруглёнными углами и тенями, золотые тайлы верхних слоёв, верхняя панель Level/Score/Matches, нижняя панель с круглыми кнопками Shuffle/Hint в стиле дерева, плавный zoom-in по мере разборки игрового поля.

### Изменённые файлы
- `index.html` — новая структура: верхний бар со статистикой, нижний бар с круглыми кнопками SVG, убран Press Start 2P шрифт
- `style.css` — полный редизайн: зелёный градиент, реалистичные 3D-тайлы, золотые layer-top, деревянный footer, адаптив
- `app.js` — добавлен zoom-in при удалении тайлов, tile-corner элемент, layer-top класс для верхних слоёв

### Как перенести в main
```bash
git cherry-pick 28582e073cd377952e2f65158943e21961a6b5b4
```

---

## #75 — А сделай-ка мне вместо тетриса классическую игру маджонг.
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `00cc9b7`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `app.js`
- `index.html`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 00cc9b7df3f4a131e766fcf4ecec4e88faef4874
```

---


## #75 — А сделай-ка мне вместо тетриса классическую игру маджонг
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `e28664c`
**Статус:** ✅ готово к переносу

### Что сделано
Полностью заменён тетрис на классическую игру Mahjong Solitaire. Реализована раскладка "Черепаха" из 144 тайлов на 4 слоях, логика свободных тайлов (без перекрытия сверху и открытый хотя бы один бок), матчинг пар, подсказки, перемешивание, подсчёт очков.

### Изменённые файлы
- `index.html` — новый UI для маджонга (статистика, игровое поле, кнопки Hint/Shuffle)
- `style.css` — стили для тайлов маджонга с 3D-эффектом, адаптивная вёрстка
- `app.js` — полная логика игры маджонг (раскладка, свободные тайлы, матчинг, hint, shuffle)

### Как перенести в main
```bash
git cherry-pick e28664c90585d4e02b7120e9adad8fdf5333f4b3
```

---

## #74 — измени цвет заголовка игры так, чтобы каждая буква писалась разным цветом
**Дата:** 2026-02-06
**Ветка:** dev/Gleb
**Коммит:** `87d23ef`
**Статус:** ✅ готово к переносу

### Изменённые файлы
- `Devlog.md`
- `app.js`
- `index.html`
- `style.css`

### Как перенести в main
```bash
git cherry-pick 87d23ef82ea0dda93d26dd577606e2cbf7a9098a
```

---
